<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Score Predictor</title>
    <!-- Use Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 p-4 min-h-screen flex items-center justify-center">
    <div class="container mx-auto p-8 bg-gray-800 rounded-xl shadow-lg border border-gray-700 max-w-2xl w-full">
        <h1 class="text-4xl font-bold text-center text-teal-400 mb-2 animate-pulse">Movie Score Predictor</h1>
        <p class="text-center text-gray-400 mb-8">
            Select a movie from the list below to get its predicted score based on a small, hardcoded dataset.
        </p>

        <div id="movie-list" class="grid gap-4 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2">
            <!-- Movie buttons will be populated here by JavaScript -->
        </div>

        <div id="result-area" class="mt-8 p-6 bg-gray-700 rounded-xl border border-gray-600 shadow-inner hidden">
            <h2 class="text-2xl font-semibold mb-4 text-teal-300">Prediction Results</h2>
            <div id="loading" class="text-center hidden">
                <svg class="animate-spin h-8 w-8 text-white mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <p class="mt-2 text-gray-400">Predicting score...</p>
            </div>
            <div id="prediction-info" class="space-y-2">
                <!-- Prediction data will be populated here -->
            </div>
        </div>

        <!-- Pop-up for errors -->
        <div id="error-popup" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
            <div class="bg-red-800 p-6 rounded-xl shadow-xl text-center border-2 border-red-500">
                <h3 class="text-2xl font-bold text-red-300 mb-2">Error</h3>
                <p id="error-message" class="text-gray-200"></p>
                <button onclick="document.getElementById('error-popup').classList.add('hidden')" class="mt-4 px-6 py-2 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg transition-colors">Close</button>
            </div>
        </div>
    </div>

    <script>
        // Hardcoded movie data to build the UI, must match the Python file
        const upcoming_movies_data = [
            "The Batman - Part II",
            "TRON: Ares",
            "Blade",
            "The Super Mario Galaxy Movie",
            "Elio",
            "How to Train Your Dragon",
            "F1",
            "Mission: Impossible â€“ The Final Reckoning",
            "The Mandalorian and Grogu",
            "Masters of the Universe",
            "Mortal Kombat II",
            "Toy Story 5",
            "Supergirl: Woman of Tomorrow"
        ];

        // Get the DOM elements
        const movieList = document.getElementById('movie-list');
        const resultArea = document.getElementById('result-area');
        const loadingIndicator = document.getElementById('loading');
        const predictionInfo = document.getElementById('prediction-info');
        const errorPopup = document.getElementById('error-popup');
        const errorMessage = document.getElementById('error-message');

        // Function to show a custom error pop-up
        function showError(message) {
            errorMessage.textContent = message;
            errorPopup.classList.remove('hidden');
        }

        // Function to create and append movie buttons
        function createMovieButtons() {
            upcoming_movies_data.forEach(movieTitle => {
                const button = document.createElement('button');
                button.textContent = movieTitle;
                button.className = "w-full p-4 bg-gray-700 hover:bg-600 text-center font-semibold rounded-lg shadow-md transition-all transform hover:scale-105 active:scale-95 border-2 border-gray-600 hover:border-teal-500 focus:outline-none focus:ring-2 focus:ring-teal-500";
                button.onclick = () => getPrediction(movieTitle);
                movieList.appendChild(button);
            });
        }

        // Function to handle the prediction request
        async function getPrediction(movieTitle) {
            resultArea.classList.add('hidden');
            loadingIndicator.classList.remove('hidden');
            predictionInfo.innerHTML = '';

            try {
                // The URL of your Flask server's prediction endpoint
                const url = 'http://localhost:5000/predict';
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ movie_title: movieTitle })
                });

                if (!response.ok) {
                    const errorText = await response.json();
                    throw new Error(errorText.error || `HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                // Clear previous results and show the results area
                loadingIndicator.classList.add('hidden');
                resultArea.classList.remove('hidden');

                // Display the results
                predictionInfo.innerHTML = `
                    <p class="text-gray-300"><span class="font-bold text-teal-400">Movie Title:</span> ${movieTitle}</p>
                    <p class="text-gray-300"><span class="font-bold text-teal-400">Predicted Score:</span> <span class="text-xl font-bold text-yellow-400">${data.predicted_score.toFixed(2)}</span> / 10</p>
                    ${data.actual_score ? `<p class="text-gray-300"><span class="font-bold text-teal-400">Actual Score:</span> <span class="text-xl font-bold text-green-400">${data.actual_score.toFixed(2)}</span> / 10</p>` : ''}
                    <p class="text-gray-300"><span class="font-bold text-teal-400">Model RMSE:</span> ${data.rmse.toFixed(4)}</p>
                    <p class="text-gray-500 mt-4 text-sm">${data.info}</p>
                `;

            } catch (error) {
                loadingIndicator.classList.add('hidden');
                console.error('Prediction failed:', error);
                showError(`Could not connect to the server. Please ensure the Python Flask app is running. Error: ${error.message}`);
            }
        }

        // Initialize the UI on page load
        document.addEventListener('DOMContentLoaded', createMovieButtons);
    </script>
</body>
</html>
